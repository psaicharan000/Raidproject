---
version: 0.2
env:
  secrets-manager:
    LOGIN: psaicharan000/sonar:sonartoken
    HOST: psaicharan000/sonar:host
    Organization: psaicharan000/sonar:organization
    Project: psaicharan000/sonar:Project
    build:
      commands:
        - mvn sonar:sonar -Dsonar.login=$LOGIN -Dsonar.host.url=$HOST
          -Dsonar.projectKey=$Project -Dsonar.organization=$Organization
        - sleep 5
        - curl
          https://sonarcloud.io/api/qualitygates/project_status?projectKey=$Project
          >result.json
        - cat result.json
        - if [ $(jq -r '.projectStatus.status' result.json) = ERROR ] ; then
          $CODEBUILD_BUILD_SUCCEEDING -eq 0 ;fi
artifacts:
  files:
    - "**/*"
